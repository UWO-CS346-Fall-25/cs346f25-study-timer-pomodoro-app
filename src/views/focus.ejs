<%- include('partials/head', { title }) %>
<body class="page-<%= pageId %>">
  <%- include('partials/header') %>

  <main class="container">
    <section class="page-intro">
      <h1>Focus sessions planner</h1>
      <p>
        Draft, launch, and record your upcoming study sprints. Adjust presets, fine-tune intervals, and
        log completed sessions so the rest of FocusFlow can surface insights.
      </p>
    </section>

    <% if (flash) { %>
      <div class="alert alert-<%= flash.type %>">
        <p><%= flash.heading %></p>
      </div>
    <% } %>

    <section class="timer-layout">
      <div class="timer-card">
        <p class="timer-label" id="timerLabel">Current interval: <%= (focusPresets && focusPresets[0]?.label) || 'Classic' %>
        </p>
        <div class="timer-display" id="timerDisplay">25:00</div>
        <div class="timer-controls">
          <button class="button primary" type="button">Start</button>
          <button class="button ghost" type="button">Pause</button>
          <button class="button ghost" type="button">Reset</button>
        </div>
        <div class="interval-toggle">
          <button class="chip active" id="chipFocus" type="button">Focus</button>
          <button class="chip" id="chipBreak" type="button">Break</button>
          <button class="chip" id="chipLong" type="button">Long Break</button>
        </div>
      </div>

      <aside class="preset-panel">
        <h2>Quick presets</h2>
        <ul>
          <% focusPresets.forEach((preset, i) => { %>
            <li>
              <button
                class="chip <%= i === 0 ? 'active' : '' %>"
                data-focus="<%= preset.focus %>"
                data-break="<%= preset.break %>"
                data-cycles="<%= preset.cycles %>"
                type="button"
              >
                <span class="preset-name"><%= preset.label %></span>
                <span class="preset-details">
                  <%= preset.focus %> / <%= preset.break %> minutes · <%= preset.cycles %> cycles
                </span>
              </button>
            </li>
          <% }); %>
        </ul>
        <p class="preset-note">
          Upcoming iterations will let you customize cycles and save your go-to routines.
        </p>
      </aside>
    </section>

    <section class="schedule-grid">
      <article>
        <h2>Session queue</h2>
        <ul class="session-list" id="sessionList">
          <% if (sessions.length === 0) { %>
            <li class="empty-state">
              No sessions queued yet. Use the form to add your first focus block.
            </li>
          <% } else { %>
            <% sessions.forEach((session) => { %>
              <li data-session-id="<%= session.id %>">
                <button
                  type="button"
                  class="queue-item"
                  data-session-id="<%= session.id %>"
                  data-title="<%= session.title %>"
                  data-focus="<%= session.focusMinutes %>"
                  data-break="<%= session.breakMinutes %>"
                  data-cycles="<%= session.cycles %>"
                >
                  <h3><%= session.title %></h3>
                  <p>
                    <%= session.cycles %> × <%= session.focusMinutes %> minute focus /
                    <%= session.breakMinutes %> minute break · Mood:
                    <span><%= session.mood %></span>
                  </p>
                </button>
              </li>
            <% }); %>
          <% } %>
        </ul>
      </article>

      <article>
        <h2>Checkpoint checklist</h2>
        <ul class="checklist">
          <li>Define your study intention for this block</li>
          <li>Silence notifications and set ambient sound</li>
          <li>Jot a quick reflection during each break</li>
          <li>Log energy level once the cycle wraps</li>
        </ul>
      </article>

      <article>
        <h2>Add a session to your queue</h2>
        <form
          id="addSessionForm"
          action="/focus/sessions"
          method="POST"
          class="session-form"
          novalidate
          data-validate
        >
          <input type="hidden" name="_csrf" value="<%= csrfToken %>" />

          <label for="title">Session label</label>
          <input
            type="text"
            id="title"
            name="title"
            maxlength="60"
            value="<%= formValues.title || '' %>"
            aria-describedby="titleHelp"
            class="<%= formErrors.title ? 'error' : '' %>"
            required
          />
          <p id="titleHelp" class="field-hint">Example: “Discrete math practice set”</p>
          <% if (formErrors.title) { %>
            <p class="field-error"><%= formErrors.title %></p>
          <% } %>

          <div class="form-grid">
            <div>
              <label for="focusMinutes">Focus minutes</label>
              <input
                type="number"
                id="focusMinutes"
                name="focusMinutes"
                min="10"
                max="90"
                value="<%= formValues.focusMinutes || 25 %>"
                class="<%= formErrors.focusMinutes ? 'error' : '' %>"
                required
              />
              <% if (formErrors.focusMinutes) { %>
                <p class="field-error"><%= formErrors.focusMinutes %></p>
              <% } %>
            </div>

            <div>
              <label for="breakMinutes">Break minutes</label>
              <input
                type="number"
                id="breakMinutes"
                name="breakMinutes"
                min="3"
                max="30"
                value="<%= formValues.breakMinutes || 5 %>"
                class="<%= formErrors.breakMinutes ? 'error' : '' %>"
                required
              />
              <% if (formErrors.breakMinutes) { %>
                <p class="field-error"><%= formErrors.breakMinutes %></p>
              <% } %>
            </div>

            <div>
              <label for="cycles">Cycles</label>
              <input
                type="number"
                id="cycles"
                name="cycles"
                min="1"
                max="8"
                value="<%= formValues.cycles || 4 %>"
                class="<%= formErrors.cycles ? 'error' : '' %>"
                required
              />
              <% if (formErrors.cycles) { %>
                <p class="field-error"><%= formErrors.cycles %></p>
              <% } %>
            </div>
          </div>

          <label for="mood">
            How are you feeling?
            <span class="label-note">(Optional note)</span>
          </label>
          <select
            id="mood"
            name="mood"
            class="<%= formErrors.mood ? 'error' : '' %>"
          >
            <option value="">Select your mood</option>
            <% const moodOptions = ['Focused', 'Calm', 'Motivated', 'Tired', 'Stressed', 'Energized', 'Steady']; %>
              <% moodOptions.forEach(function(m) { %>
                <option value="<%= m %>" <%= (formValues.mood === m) ? 'selected' : '' %>><%= m %></option>
              <% }) %>
          </select>


          <button class="button primary" type="submit">Add session</button>
        </form>
      </article>

      <article>
        <h2>Today at a glance</h2>
        <ul class="summary-list" id="sessionSummary">
          <li>
            <strong>Total focus minutes:</strong>
            <span data-summary="focus"><%= summary.totalFocusMinutes %></span>
          </li>
          <li>
            <strong>Total cycles scheduled:</strong>
            <span data-summary="cycles"><%= summary.totalCycles %></span>
          </li>
          <li>
            <strong>Average focus block:</strong>
            <span data-summary="average"><%= summary.averageFocusBlock || 0 %> minutes</span>
          </li>
        </ul>
      </article>

      <article>
        <h2>Upcoming focus goals</h2>
        <ul class="goal-list" id="focusGoalsList">
          <% if (!goals || goals.length === 0) { %>
            <li class="empty-state">No goals scheduled yet. Add one to guide your next deep work block.</li>
          <% } else { %>
            <% goals.forEach((goal) => { %>
              <li data-goal-id="<%= goal.id %>">
                <div class="goal-item">
                  <h3><%= goal.title %></h3>
                  <p class="goal-meta">
                    <span data-goal-priority="<%= goal.priority.toLowerCase() %>"><%= goal.priority %> priority</span>
                    ·
                    <time datetime="<%= goal.dueDate %>">
                      Due
                      <%= new Date(goal.dueDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) %>
                    </time>
                  </p>
                  <p class="goal-notes">
                    <strong>Focus target:</strong> <%= goal.targetFocusMinutes %> minutes
                    <% if (goal.setReminder) { %>
                      · Reminder enabled
                    <% } %>
                    <% if (goal.notes) { %>
                      <br />
                      <span><%= goal.notes %></span>
                    <% } %>
                  </p>
                </div>
              </li>
            <% }); %>
          <% } %>
        </ul>
      </article>

      <article>
        <h2>Plan a focus goal</h2>
        <p class="form-intro">
          Capture the study target you want to hit this week. These goals power the insights view and upcoming reminders.
        </p>
        <form
          id="addGoalForm"
          action="/focus/goals"
          method="POST"
          class="goal-form"
          novalidate
          data-goal-form
        >
          <input type="hidden" name="_csrf" value="<%= csrfToken %>" />

          <label for="goalTitle">Goal title</label>
          <input
            type="text"
            id="goalTitle"
            name="title"
            maxlength="80"
            value="<%= goalFormValues.title || '' %>"
            class="<%= goalFormErrors.title ? 'error' : '' %>"
            required
          />
          <% if (goalFormErrors.title) { %>
            <p class="field-error"><%= goalFormErrors.title %></p>
          <% } %>

          <div class="form-grid">
            <div>
              <label for="goalTargetMinutes">Target focus minutes</label>
              <input
                type="number"
                id="goalTargetMinutes"
                name="targetFocusMinutes"
                min="30"
                max="600"
                step="15"
                value="<%= goalFormValues.targetFocusMinutes || 90 %>"
                class="<%= goalFormErrors.targetFocusMinutes ? 'error' : '' %>"
                required
              />
              <% if (goalFormErrors.targetFocusMinutes) { %>
                <p class="field-error"><%= goalFormErrors.targetFocusMinutes %></p>
              <% } %>
            </div>

            <div>
              <label for="goalDueDate">Due date</label>
              <input
                type="date"
                id="goalDueDate"
                name="dueDate"
                value="<%= goalFormValues.dueDate || '' %>"
                class="<%= goalFormErrors.dueDate ? 'error' : '' %>"
                required
              />
              <% if (goalFormErrors.dueDate) { %>
                <p class="field-error"><%= goalFormErrors.dueDate %></p>
              <% } %>
            </div>

            <div>
              <label for="goalPriority">Priority</label>
              <select
                id="goalPriority"
                name="priority"
                class="<%= goalFormErrors.priority ? 'error' : '' %>"
                required
              >
                <option value="">Select priority</option>
                <% goalPriorityOptions.forEach(function(option) { %>
                  <option
                    value="<%= option %>"
                    <%= goalFormValues.priority === option ? 'selected' : '' %>
                  >
                    <%= option %>
                  </option>
                <% }) %>
              </select>
              <% if (goalFormErrors.priority) { %>
                <p class="field-error"><%= goalFormErrors.priority %></p>
              <% } %>
            </div>
          </div>

          <label for="goalNotes">
            Notes <span class="label-note">(Optional)</span>
          </label>
          <textarea
            id="goalNotes"
            name="notes"
            rows="3"
            maxlength="160"
            class="<%= goalFormErrors.notes ? 'error' : '' %>"
          ><%= goalFormValues.notes || '' %></textarea>
          <% if (goalFormErrors.notes) { %>
            <p class="field-error"><%= goalFormErrors.notes %></p>
          <% } %>

          <div class="checkbox-row">
            <input
              type="checkbox"
              id="goalReminder"
              name="setReminder"
              <%= goalFormValues.setReminder ? 'checked' : '' %>
            />
            <label for="goalReminder">Send me a reminder the day before</label>
          </div>

          <button class="button primary" type="submit">Save goal</button>
        </form>
      </article>
    </section>
  </main>

  <%- include('partials/footer') %>
  <script src="/js/main.js"></script>
</body>
</html>
