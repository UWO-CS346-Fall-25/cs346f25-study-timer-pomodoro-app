<%- include('partials/head', { title }) %>
<body class="page-<%= pageId %>">
  <%- include('partials/header') %>

  <main class="container">
    <section class="page-intro">
      <h1 class="with-icon">Progress insights <i class="icon" data-lucide="chart-line"></i></h1>
      <p>
        Pull real-time highlights from your session queue. As you log more focus blocks, these cards
        will adapt automatically so you can decide what to schedule next.
      </p>
    </section>

    <section class="insight-metrics">
      <article class="metric-card">
        <h2 class="with-icon">Weekly streak <i class="icon" data-lucide="flame"></i></h2>
        <p class="metric-value"><%= insights.streakDays %> day<%= insights.streakDays === 1 ? '' : 's' %></p>
        <p class="metric-caption">Focus blocks logged in the last few days.</p>
      </article>
      <article class="metric-card">
        <h2 class="with-icon">Total focus time <i class="icon" data-lucide="alarm-clock"></i></h2>
        <p class="metric-value"><%= insights.totalFocusLabel %></p>
        <p class="metric-caption">
          Across <%= summary.totalCycles %> completed intervals so far.
        </p>
      </article>
      <article class="metric-card">
        <h2 class="with-icon">Energy check <i class="icon" data-lucide="battery-charging"></i></h2>
        <p class="metric-value"><%= insights.latestMood %></p>
        <p class="metric-caption">Latest reflection pulled from your focus queue.</p>
      </article>
      <article class="metric-card">
        <h2 class="with-icon">Active goals <i class="icon" data-lucide="circle-check-big"></i></h2>
        <p class="metric-value"><%= goalSnapshot.total %></p>
        <p class="metric-caption">
          <%= goalSnapshot.highPriority %> high priority · <%= goalSnapshot.nextDueLabel %>
        </p>
      </article>
    </section>

    <section class="insight-grid">
      <article>
        <h2>Recent sessions</h2>
        <% if (recentSessions.length === 0) { %>
          <p class="empty-state">No sessions logged yet. Add one from the Focus page.</p>
        <% } else { %>
          <ul class="session-history" id="insightSessionList">
            <% recentSessions.forEach((session) => { %>
              <li data-session-id="<%= session.id %>">
                <h3><%= session.title %></h3>
                <p>
                  <%= session.cycles %> × <%= session.focusMinutes %> minute focus blocks
                  · <span><%= session.mood %></span>
                </p>
              </li>
            <% }); %>
          </ul>
        <% } %>
      </article>

      <article>
        <h2>Reflection prompts</h2>
        <ul class="prompt-list">
          <% reflectionPrompts.forEach((prompt) => { %>
            <li><%= prompt %></li>
          <% }); %>
        </ul>
        <p class="prompt-note">
          These prompts will eventually anchor guided journaling between sessions.
        </p>
      </article>

      <article>
        <h2>Goal timeline</h2>
        <% if (!goals || goals.length === 0) { %>
          <p class="empty-state">Add a focus goal to start tracking upcoming milestones.</p>
        <% } else { %>
          <ul class="goal-timeline" id="insightGoalList">
            <% goals.forEach((goal) => { %>
              <li data-goal-id="<%= goal.id %>">
                <h3><%= goal.title %></h3>
                <p>
                  <strong><%= goal.priority %></strong> priority
                  · <%= goal.targetFocusMinutes %> min target · due
                  <time datetime="<%= goal.dueDate %>">
                    <%= new Date(goal.dueDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) %>
                  </time>
                </p>
              </li>
            <% }); %>
          </ul>
        <% } %>
      </article>
    </section>
  </main>

  <%- include('partials/footer') %>
</body>
</html>
